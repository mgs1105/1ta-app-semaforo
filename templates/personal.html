{% extends 'base.html' %}

{% block header %}
<h1>{% block title %} Personal {% endblock %}</h1>
{% endblock %}

{% block content %}

{% with mensajes = get_flashed_messages() %}
{% if mensajes %}
{% for m in mensajes %}
<div class="alert alert-primary alert-dismissible fade show" role="alert">
    <p> {{m}}</p>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
{% endfor %}
{% endif %}
{% endwith %}

<style>
#carta{
    margin: 20px auto;
}
select, #btn-personal{
    padding: 1px 10px;
}
#btn-personal{
    background-color: #2D219B;
    color: white;
    text-align: center;
    border-radius: 5px;
    padding: 0 15px;
}

#tabla-tareas{
    margin-left: auto;
    margin-right: auto;
    min-height: .01%;
    overflow-x: auto;
    width: 100%;
}
@media (max-width: 1350px) {
    #tabla-tareas{
        width: 100%;
        margin-bottom: 15px;
        overflow-y: hidden;
        -ms-overflow-style: -ms-autohiding-scrollbar;
    }
}
</style>

<body onload="brython()">
    <h3>Administrar personal</h3>
    <div class="container" id="carta">
        <form action="{{url_for('crearpersonal')}}" method="post" id="per">
            <label for="nombre">Nombre</label>
            <input name="nombre" id="nombre" type="text" onkeypress='return verificar_nombre(event)' required/>
            <label for="apellido">Apellido</label>
            <input name="apellido" id="apellido" type="text" pattern="[a-zA-Z]" required/>
            <label for="rut">Rut</label>
            <input name="rut" id="rut" placeholder="Sin puntos" maxlength="8" onkeypress='return validarNum(event)' required/> -
            <input type="text" name="digito" id="digito" maxlength="1" width="1px" placeholder="digito verificador" onkeypress='return verificar(event)' required/> 
            <label for="unidadtrabajo">Unidad de trabajo</label>
            <select name="unidadtrabajo">
                {% for unidad in data %}
                <option value="{{unidad.nombre}}">{{ unidad.nombre }}</option>
                {% endfor %}
            </select>
            <input type="submit" value="registrar" id="btn-personal" onclick="verificar()"/>
        </form>
    </div>

    <div id="tabla-tareas" class="container">
        <table class="table table-striped table-bordered bg-white table-sm">
            <thead class="thead-primary">
                <tr class="thead-primary">
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Rut</th>
                    <th>Unidad de trabajo</th>
                    <th>Editar</th>
                    <th>Eliminar</th>
                </tr>    
            </thead>
            {% for personal in data2 %}
            <tbody>
                <tr>
                    <td>{{ personal.nombre }}</td>
                    <td>{{ personal.apellido }}</td>
                    <td>{{ personal.rut }}</td>
                    <td>{{ personal.unidadtrabajo }}</td>
                    <td> <a href="/editarpersonal/{{personal.id}}" class="btn btn-primary">Editar</a> </td>
                    <td> <a href="/eliminarpersonal/{{personal.id}}" class="btn btn-danger">Eliminar</a> </td>
                </tr>    
            </tbody>
            {% endfor %}
        </table>
    </div>
</body>

<script>
function validarNum(event) {
    if (event.charCode >= 48 && event.charCode <= 57){
        return true;
    } else {
        return false;
    }
}

function verificar(event) {
    if (event.charCode >= 48 && event.charCode <= 57 || event.charCode == 107){
        return true;
    } else {
        return false;
    }
}

function verificar_nombre(event) {
    if (event.charCode >= 65 && event.charCode <= 90 || event.charCode >= 97 && event.charCode <= 122) {
        return true;
    } else {
        return false;
    }

}
</script>

{% endblock %}